#! /usr/bin/env zsh

# git-dir - Display the path to the .git directory
# 
# Usage:
#   git-dir                 # Display .git directory path
#   ls $(git-dir)/hooks     # List git hooks
#   git-dir --help          # Show help
#
# Examples:
#   git-dir                         # → /Users/kud/my/.git
#   ls $(git-dir)/hooks             # → list git hooks
#   cat $(git-dir)/config           # → show git config
#
# Returns:
#   - Absolute path to .git directory
#   - Empty output if not in a git repository
#   - Exit code 0 on success, 1 on error

# Source helper functions
source "${MY}/core/utils/helper.zsh"

# Help function
show_help() {
  show_command_help "git-dir" "Display the path to the .git directory" \
    "git-dir [--help]" \
    "Example: git-dir → /Users/user/project/.git"
}

# Check for help flag first
handle_help_flag "$1"

# Get git directory using rev-parse --git-dir and resolve to absolute path
git_dir=$(git rev-parse --git-dir 2>/dev/null)

if [[ $? -eq 0 && -n "$git_dir" ]]; then
  # Convert to absolute path
  echo "${git_dir:A}"
  exit 0
else
  # Not in a git repository - exit silently with error code
  exit 1
fi
