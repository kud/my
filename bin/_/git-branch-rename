#!/usr/bin/env zsh

set -e

if [[ -z "$1" ]]; then
  echo "Error: No new branch name provided."
  echo "Usage: $0 <new-branch-name>"
  exit 1
fi

if ! git rev-parse --is-inside-work-tree &>/dev/null; then
  echo "Error: Not inside a git repository."
  exit 2
fi

new_branch="$1"
current_branch=$(git rev-parse --abbrev-ref HEAD)

if [[ "$new_branch" == "$current_branch" ]]; then
  echo "Error: New branch name is the same as the current branch."
  exit 3
fi

echo "Renaming branch '$current_branch' to '$new_branch'..."
git branch -m "$new_branch"

echo "Updating remote..."
git push origin :"$current_branch" "$new_branch"
git push origin -u "$new_branch"

echo "Branch renamed and remote updated successfully."
