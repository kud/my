#! /usr/bin/env zsh

# Get the list of branches marked as gone but filter out origin/HEAD
BRANCHES_ARRAY=($(git branch -vv | grep -v 'origin/HEAD' | awk '/: gone]/{print $1}' | tr '\n' ' '))

# Sync the local repository with the remote
git fetch
git pull

echo ""

# Check if there are any branches to delete
if [ -n "${BRANCHES_ARRAY}" ]; then
  for branch in $BRANCHES_ARRAY; do
    echo "❯ ${branch}"
  done

  echo ""

  read "?Press any key to continue the deletion… or ctrl+c to stop." </dev/tty

  echo ""

  # Get the currently checked-out branch
  CURRENT_BRANCH=$(git symbolic-ref --short HEAD)

  # Delete the branches that are no longer on the remote
  for branch in $BRANCHES_ARRAY; do
    if [ "$branch" != "$CURRENT_BRANCH" ]; then
      git branch -D $branch
    else
      echo "Skipping deletion of currently checked-out branch: $branch"
    fi
  done

else
  echo "No branch to clean."
fi
