#! /usr/bin/env zsh

source $MY/core/helper

## define cask application folder
export HOMEBREW_CASK_OPTS=--appdir=/Applications

## install brew
if ! type "brew" >/dev/null; then
  echo_space
  echo_title_install "homebrew"
  sudo -v
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

## install zsh
if [[ $(which zsh) == "/bin/zsh" ]]; then
  echo_space
  echo_title_install "zsh"
  brewinstall zsh
  echo "${HOMEBREW_PREFIX}/bin/zsh" | sudo tee -a /etc/shells
  chsh -s ${HOMEBREW_PREFIX}/bin/zsh
fi

## install bash
if [[ $(which bash) == "/bin/bash" ]]; then
  echo_space
  echo_title_install "bash"
  brewinstall bash
  echo "${HOMEBREW_PREFIX}/bin/bash" | sudo tee -a /etc/shells
fi

## update/upgrade brew
echo_space
echo_title_update "brew"
brew update && brew upgrade

## install brew packages
echo_space
echo_title_install "brew packages"

### tap
brewtap homebrew/cask
brewtap homebrew/cask-versions

### system
brewinstall autojump
brewinstall brightness
brewinstall exa # Modern replacement for 'ls' — https://the.exa.website
brewinstall exiftool
brewinstall fd
brewinstall ffmpeg
brewinstall fzf
brewinstall gifsicle
brewinstall gnu-sed
brewinstall grep
brewinstall htmlcompressor
brewinstall htop
brewinstall iftop
brewinstall less # because the macOS built-in version is old
brewinstall make
brewinstall mitmproxy
brewinstall mozjpeg
brewinstall ncdu
brewinstall neofetch # system information
brewinstall p7zip
brewinstall pcre2
brewinstall pv
brewinstall pwgen
brewinstall rename
brewinstall ripgrep
brewinstall ssh-copy-id
brewinstall tree
brewinstall z

### network
brewinstall curl
brewinstall dnsmasq
brewinstall lsof
brewinstall mtr
brewinstall rclone
brewinstall rsync
brewinstall syncthing
brewinstall tcpflow # analyse tcp requests
brewinstall wget

### git
brewinstall gh
gh extension install dlvhdr/gh-dash
brewinstall git
brewinstall git-delta
brewinstall lazygit
brewinstall spr
brewinstall tig

### editors
brewinstall neovim
brewinstall vim

### languages
brewinstall readline # needed for python
brewinstall xz       # needed for python
brewinstall zlib     # needed for python

### others
brewinstall antibody
brewinstall asciinema
brewinstall bat # https://github.com/sharkdp/bat
brewinstall duf
brewinstall fnm
brewinstall glow
brewinstall gnupg
brewinstall heroku/brew/heroku
brewinstall httpie
brewinstall imagemagick
brewinstall ipcalc
brewinstall jesseduffield/lazynpm/lazynpm
brewinstall jless
brewinstall jq
brewinstall mas # Mac App Store command line interface - https://github.com/mas-cli/mas
brewinstall noborus/tap/trdsql
brewinstall node
brewinstall openjdk
sudo ln -sfn ${HOMEBREW_PREFIX}/opt/openjdk/libexec/openjdk.jdk /Library/Java/JavaVirtualMachines/openjdk.jdk
brewinstall openssl@3
brewinstall pandoc
brewinstall pyenv
brewinstall pyenv-virtualenv
brewinstall python@3.11 # however, will be installed via pyenv after
brewinstall ruby
brewinstall frum
brewinstall subversion # for Ubuntu fonts
brewinstall yarn
brewinstall yt-dlp
brewinstall molovo/revolver/revolver

## install apps
echo_space
echo_title_install "apps"

caskinstall adoptopenjdk
caskinstall altair-graphql-client
caskinstall android-file-transfer
caskinstall android-studio
caskinstall bartender
caskinstall cleanshot
caskinstall cron
caskinstall discord
caskinstall etrecheckpro
caskinstall firefox-nightly
caskinstall fliqlo
caskinstall flux
caskinstall google-chrome-canary
caskinstall grandperspective
caskinstall hyperkey
caskinstall image2icon
caskinstall imagealpha
caskinstall imageoptim
caskinstall insomnia # REST Client — https://insomnia.rest/
caskinstall iterm2-nightly
caskinstall kap
caskinstall keepassxc
caskinstall loom
caskinstall macmediakeyforwarder
caskinstall mark-text # https://marktext.github.io/website/
caskinstall meetingbar
caskinstall min
caskinstall monitorcontrol
caskinstall monodraw
caskinstall obsidian
caskinstall openmtp
caskinstall osquery
caskinstall pika
caskinstall pixelsnap
caskinstall prefs-editor
caskinstall proxyman
caskinstall qr-journal
caskinstall raycast
caskinstall rectangle
caskinstall redisinsight
caskinstall removebg
caskinstall rocket
caskinstall runjs
caskinstall shadow
caskinstall signal
caskinstall slack
caskinstall spotify
caskinstall steermouse # http://plentycom.jp/en/steermouse/
caskinstall sublime-merge-dev
caskinstall visual-studio-code
caskinstall vlc
caskinstall xcodes
caskinstall xquartz
caskinstall xrg
caskinstall zulu11
caskinstall react-native-debugger

# quicklook plugins
caskinstall qlcolorcode
caskinstall qlimagesize
caskinstall qlmarkdown
caskinstall qlprettypatch
caskinstall qlstephen
caskinstall qlvideo
caskinstall quicklook-csv
caskinstall quicklook-json
caskinstall quicklookase
caskinstall suspicious-package

xattr -d -r com.apple.quarantine ~/Library/QuickLook # remove quarantine attr since Catalina

source $MY/profiles/$OS_PROFILE/core/brew 2>/dev/null

echo_space
echo_title "Cleaning brew cask..."
brew cleanup
